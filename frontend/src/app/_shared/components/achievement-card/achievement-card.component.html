<mat-card (click)="openDetails()"
          [ngClass]="getCardClasses()"
          class="achievement-card">

  <!-- Multiple Visual Indicators for Recently Unlocked Achievements -->
  <ng-container *ngIf="isRecentlyUnlocked()">
    <!-- Animated Corner Ribbon -->
    <div class="notification-ribbon">
      <mat-icon>new_releases</mat-icon>
      <span>FROM NOTIFICATIONS</span>
    </div>
    
    <!-- Pulsing Border Overlay -->
    <div class="pulse-border"></div>
    
    <!-- Spotlight Effect -->
    <div class="spotlight-overlay"></div>
  </ng-container>

  <div class="achievement-icon" [ngClass]="categoryClass">
    <mat-icon>{{ getIconName() }}</mat-icon>
    
    <!-- Celebration level indicator -->
    <div *ngIf="isAchieved && celebrationLevel !== 'NORMAL'" class="celebration-indicator">
      <mat-icon class="celebration-icon">{{ celebrationLevel === 'EPIC' ? 'auto_awesome' : 'star' }}</mat-icon>
    </div>
    
    <!-- Dependency indicator -->
    <div *ngIf="showDependencies && hasBlockingDependencies" class="dependency-indicator" 
         [matTooltip]="getDependencyStatusText()">
      <mat-icon class="dependency-icon">link</mat-icon>
    </div>
  </div>

  <mat-card-header>
    <mat-card-title>{{ achievementData.achievement.name }}</mat-card-title>
    <mat-card-subtitle *ngIf="showDetails">
      {{ formatPoints() }}
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content *ngIf="showDetails">
    <p class="achievement-description">{{ achievementData.achievement.description }}</p>

    <!-- Dependency information -->
    <div *ngIf="showDependencies && dependencyCount > 0" class="dependency-info">
      <mat-icon class="dependency-info-icon">{{ hasBlockingDependencies ? 'lock' : 'link' }}</mat-icon>
      <span class="dependency-text">{{ getDependencyStatusText() }}</span>
    </div>

    <div *ngIf="showProgress" class="achievement-progress">
      <app-achievement-progress
        [progress]="achievementData.percentComplete"
        [category]="achievementData.achievement.category"
        [celebrationLevel]="celebrationLevel"
        [isAchieved]="isAchieved"
        [animated]="true"
        [showText]="true"
        [size]="size === 'small' ? 'small' : 'medium'">
      </app-achievement-progress>
    </div>

    <!-- Enhanced contextual information -->
    <div *ngIf="getContextualInfo()" class="achievement-context enhanced-context">
      <mat-icon class="context-icon">sports_tennis</mat-icon>
      <span>{{ getContextualInfo() }}</span>
    </div>

    <div *ngIf="isAchieved && achievementData.playerProgress.dateEarned" class="achievement-date">
      <mat-icon class="date-icon">event</mat-icon>
      Earned: {{ achievementData.playerProgress.dateEarned | date:'mediumDate' }}
    </div>
  </mat-card-content>

  <mat-card-actions *ngIf="showDetails && size !== 'small'">
    <button (click)="openDetails($event)"
            [matTooltip]="isAchieved ? 'View Achievement Details' : 'Keep Playing to Unlock'"
            color="primary"
            mat-button>
      {{ isAchieved ? 'DETAILS' : (hasBlockingDependencies ? 'LOCKED' : 'IN PROGRESS') }}
    </button>
    
    <button *ngIf="isAchieved && celebrationLevel !== 'NORMAL'"
            (click)="triggerCelebration(); $event.stopPropagation()"
            [matTooltip]="'Replay celebration'"
            color="accent"
            mat-button>
      <mat-icon>celebration</mat-icon>
      CELEBRATE
    </button>
  </mat-card-actions>
</mat-card>
